<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Guardtime KSI c SDK: T3 - Extending Tutorial</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Guardtime KSI c SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">T3 - Extending Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md29"></a>
Disclaimer</h1>
<p>For simplicity reasons, the error handling in this tutorial is mostly omitted. In practice almost all the functions in the SDK return a status code which value should be checked to be <a class="el" href="../../dd/df2/group__base.html#gga80cba280da561d1b02728cd946645197a457f8614f99ec7a367d4ca638f0fcdaa">KSI_OK</a>, which means all went well.</p>
<h1><a class="anchor" id="autotoc_md30"></a>
1. Preparation</h1>
<p>For preparation see <a class="el" href="../../dd/d52/md_tutorial_t0_basics.html">Basics Tutorial</a>.</p>
<h1><a class="anchor" id="autotoc_md31"></a>
2. Parsing</h1>
<p>Usually if a signature needs to be verified, it has been serialized into a binary format which is stored in a file or database. We won't cover reading the binary data, as it may vary on different integrations. Let's assume the signature is copied into a buffer called <code>raw</code> and it's length is stored in <code>raw_len</code>. To parse the signature we need to call <a class="el" href="../../da/d4f/group__signature.html#ga4c88395579b0262a5c75563838ce6534">KSI_Signature_parse</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="../../df/d8a/group__ksi__types.html#gaec1ceb681237b74b978a661bb3224cb2">KSI_Signature</a> *sig = NULL;</div>
<div class="line"><a class="code" href="../../da/d4f/group__signature.html#ga4c88395579b0262a5c75563838ce6534">KSI_Signature_parse</a>(ksi, raw, raw_len, &amp;sig);</div>
<div class="ttc" id="agroup__ksi__types_html_gaec1ceb681237b74b978a661bb3224cb2"><div class="ttname"><a href="../../df/d8a/group__ksi__types.html#gaec1ceb681237b74b978a661bb3224cb2">KSI_Signature</a></div><div class="ttdeci">struct KSI_Signature_st KSI_Signature</div><div class="ttdef"><b>Definition:</b> types.h:67</div></div>
<div class="ttc" id="agroup__signature_html_ga4c88395579b0262a5c75563838ce6534"><div class="ttname"><a href="../../da/d4f/group__signature.html#ga4c88395579b0262a5c75563838ce6534">KSI_Signature_parse</a></div><div class="ttdeci">#define KSI_Signature_parse(ctx, raw, raw_len, sig)</div><div class="ttdef"><b>Definition:</b> signature.h:71</div></div>
</div><!-- fragment --><p>After a successful call to <a class="el" href="../../da/d4f/group__signature.html#ga4c88395579b0262a5c75563838ce6534">KSI_Signature_parse</a> the buffer <code>raw</code> can be freed by the caller as it is not referenced by the signature.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
3. Extending</h1>
<p>After parsing and before extending the signature, we can verify it ( see <a class="el" href="../../de/d5a/md_tutorial_t2_verifying.html">Verifying tutorial</a>), but if the signature has not been extended for many years, the verification may fail (which is one of the reasons why signatures should be extended as soon as possible). Furthermore, if the extending process succeeds, the signature is automatically verified (i.e a bad signature will fail eventually anyway).</p>
<p>The extending of a signature can be done using the <a class="el" href="../../dd/df2/group__base.html#ga579c54c5eb52f9e52f454a54350dc14c">KSI_extendSignature</a> function:</p>
<div class="fragment"><div class="line"><a class="code" href="../../df/d8a/group__ksi__types.html#gaec1ceb681237b74b978a661bb3224cb2">KSI_Signature</a> *extended = NULL;</div>
<div class="line">res = <a class="code" href="../../dd/df2/group__base.html#ga579c54c5eb52f9e52f454a54350dc14c">KSI_extendSignature</a>(ksi, sig, &amp;extended);</div>
<div class="line"><span class="keywordflow">if</span> (res != <a class="code" href="../../dd/df2/group__base.html#gga80cba280da561d1b02728cd946645197a457f8614f99ec7a367d4ca638f0fcdaa">KSI_OK</a>) {</div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__base_html_ga579c54c5eb52f9e52f454a54350dc14c"><div class="ttname"><a href="../../dd/df2/group__base.html#ga579c54c5eb52f9e52f454a54350dc14c">KSI_extendSignature</a></div><div class="ttdeci">#define KSI_extendSignature(ctx, sig, extended)</div><div class="ttdef"><b>Definition:</b> ksi.h:663</div></div>
<div class="ttc" id="agroup__base_html_gga80cba280da561d1b02728cd946645197a457f8614f99ec7a367d4ca638f0fcdaa"><div class="ttname"><a href="../../dd/df2/group__base.html#gga80cba280da561d1b02728cd946645197a457f8614f99ec7a367d4ca638f0fcdaa">KSI_OK</a></div><div class="ttdeci">@ KSI_OK</div><div class="ttdef"><b>Definition:</b> ksi.h:49</div></div>
</div><!-- fragment --><p>If the signature is successfully extended, the old signature may be replaced with the new signature. To serialize the new signature see the <a class="el" href="../../dc/d3c/md_tutorial_t1_signing.html">Signing tutorial</a>.</p>
<h1><a class="anchor" id="autotoc_md33"></a>
5. Cleanup</h1>
<p>As the final step we need to free all the allocated resources. Note that the KSI context may be reused as much as needed (within a single thread) and must not be creates every time. It is also important to point out that the context must be freed last.</p>
<div class="fragment"><div class="line"><a class="code" href="../../da/d4f/group__signature.html#ga4d14e3cb5ca06780d492746d58de92dd">KSI_Signature_free</a>(extended);</div>
<div class="line"><a class="code" href="../../da/d4f/group__signature.html#ga4d14e3cb5ca06780d492746d58de92dd">KSI_Signature_free</a>(sig);</div>
<div class="line"><a class="code" href="../../dd/df2/group__base.html#ga40d9e85aa8b1bd9218e8395e5a79838a">KSI_CTX_free</a>(ksi); <span class="comment">/* Must be freed last. */</span></div>
<div class="ttc" id="agroup__base_html_ga40d9e85aa8b1bd9218e8395e5a79838a"><div class="ttname"><a href="../../dd/df2/group__base.html#ga40d9e85aa8b1bd9218e8395e5a79838a">KSI_CTX_free</a></div><div class="ttdeci">void KSI_CTX_free(KSI_CTX *ctx)</div></div>
<div class="ttc" id="agroup__signature_html_ga4d14e3cb5ca06780d492746d58de92dd"><div class="ttname"><a href="../../da/d4f/group__signature.html#ga4d14e3cb5ca06780d492746d58de92dd">KSI_Signature_free</a></div><div class="ttdeci">void KSI_Signature_free(KSI_Signature *signature)</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
